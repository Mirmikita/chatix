<!-- В <script> -->
<script>
    let ws;
    let username;
    let room;

    function connect() {
        username = document.getElementById('username').value || 'Аноним';
        room = document.getElementById('room').value || 'general';

        if (!room || !username) {
            alert('Введите имя и комнату!');
            return;
        }

        const protocol = window.location.protocol === "https:" ? "wss" : "ws";
        ws = new WebSocket(`${protocol}://${window.location.host}/ws/${room}`);

        ws.onopen = () => {
            document.getElementById('login').style.display = 'none';
            document.getElementById('chat').style.display = 'block';
            document.getElementById('room-title').innerText = `Комната: ${room}`;
        };

        ws.onmessage = (event) => {
            const messages = document.getElementById('messages');
            const message = document.createElement('div');
            message.classList.add('message');

            if (event.data.includes(username + ':')) {
                message.classList.add('my-message');
            } else {
                message.classList.add('other-message');
            }

            message.textContent = event.data;
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
        };
    }

    function sendMessage() {
        const input = document.getElementById('messageInput');
        const text = input.value.trim();

        if (ws && ws.readyState === WebSocket.OPEN && text) {
            ws.send(JSON.stringify({
                sender: username,
                text: text
            }));
            input.value = '';
        }
    }

    document.getElementById('messageInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>
